# 1. Название проекта
**ADS Sheets Copilot (офлайн‑агент отчетности)**

---

# 2. Описание проекта
Локальный ИИ‑агент для руководителя ADS Group на Windows, который:
- **автоматизирует работу с таблицами и отчетностью** по доходам/расходам, остаткам и закупкам;
- **сам обновляет** данные из локальных Excel/CSV/выгрузок 1С и из сети (Google Sheets, почта, корпоративные порталы, CRM/ERP),
- **офлайн обрабатывает** данные локальной моделью (LLM не выходит в интернет),
- выдает **готовые файлы Excel/Word** и сводные графики,
- имеет **простой GUI** с кнопками‑шорткатами под типовые запросы и поле свободного запроса.

Ключевая идея — **заменить рутинную работу специалиста 1С/Excel**, сократив время подготовки регулярных отчетов до «кнопка → готово ≤ 2 минут» и обеспечив строгую точность сопоставления данных.

---

# 3. Целевая аудитория
- **Руководитель ADS Group** (единственный пользователь, Windows‑ноутбук, без DevOps/ Docker).
- Потенциально — другие руководители отделов/проектов с похожими требованиями к офлайн‑работе и приватности.

---

# 4. Основные функции и возможности
**4.1. Данные и обновление**
- Поддержка локальных **Excel/CSV** и **выгрузок 1С** (из папки наблюдения).
- Коннекторы к **Google Sheets/диску**, **почте**, **CRM/ERP/порталам** для периодической актуализации (скрипты ходят в сеть, LLM — нет).
- Авто‑инкрементальное обновление и пересборка индекса знаний (RAG) при появлении новых файлов.

**4.2. Обработка и отчеты**
- Предустановленные сценарии (шорткаты):
  1) **Еженедельный P&L** (доходы/расходы) с контролем разрезов (проекты, контрагенты, статьи).
  2) **Остатки и закупки**: движение запасов, точки заказа, отклонения.
  3) **Кассовый план**: прогноз поступлений/платежей на N недель.
- Свободные запросы на естественном языке («Покажи закупки по поставщику X за октябрь»).
- Выходные артефакты: **XLSX**, **DOCX** (шаблоны), **PNG графики**.
- Строгая **валидация фактов**: структурированный вывод, проверка типов/диапазонов, явное сообщение «нет данных» при пробелах.

**4.3. Интерфейс**
- Локальный **простых GUI**: панель шорткатов + строка запроса.
- История запусков, лог ошибок, кнопка «Показать источник/файл».

**4.4. Безопасность и приватность**
- **Локальное исполнение**. LLM не имеет выхода в интернет.
- **Шифрование** хранилища (индекс RAG, кэш, конфиги), локальные секреты в `.env`.
- Один пользователь → без ролей, опциональный PIN на запуск.

**4.5. Архитектура агентов**
- **Agent‑Updater** (онлайн‑инструменты без LLM): синхронизация источников, нормализация, дедупликация, контроль версий датасетов.
- **Agent‑Analyst** (офлайн LLM + Python): агрегации, объяснения, формирование отчетов и файлов, Structured Output.

---

# 5. Технологии и подходы из курса (и как применяются)
- **Работа с LLM через API (OpenAI‑совместимые интерфейсы)**: использование локально запущенной модели с OpenAI‑совместимым эндпоинтом (например, LM Studio/Ollama + openai‑совместимый сервер). LLM применяется в Agent‑Analyst для интерпретации запросов, генерации SQL/Pandas‑трансформаций и текстовых выводов.
- **Structured Output**: строгие JSON‑схемы для промежуточных результатов (схемы «DatasetSpec», «ReportSpec», «ValidationResult») и финальных отчетов; валидация pydantic → генерация XLSX/DOCX.
- **Мультимодальность (голос/изображения)**:
  - Этап 1: опционально голосовой ввод запроса (ASR локально).
  - Этап 2+: OCR таблиц из фото/сканов накладных (при расширении задач снабжения).
- **RAG (Retrieval‑Augmented Generation)**: локальная векторная БД (например, Chroma/SQLite‑VSS) для регламентов, шаблонов, исторических выгрузок; гибридный поиск + ключевые поля (поставщик, проект, статья).
- **Агентные паттерны и сложные workflow с LangGraph**: граф из узлов «Fetch → Normalize → Index → Validate → Analyze → Render → Export», два сабграфа для Updater/Analyst, ретраи/таймауты, компенсации.
- **MCP (Model Context Protocol)**: интеграция с внешними инструментами как MCP‑инструменты: чтение Google Sheets, IMAP/POP, HTTP‑скрейперы порталов, файловый вотчер; также экспорт в Telegram/почту (без использования облачных LLM).

---

# 6. План развития проекта по модулям курса
**Модуль 1 — LLM API (неделя 1)**
- Минимальный офлайн‑стек: локальная LLM с OpenAI‑совместимым API.
- CLI/минимальный GUI: «Собери P&L за период из локальной папки `Data/`».
- KPI: отчёт в XLSX формируется из одного файла ≤ 2 мин.

**Модуль 2 — Structured Output**
- Введение pydantic‑схем: `DatasetSpec`, `ReportSpec`.
- Жёсткая валидация типов/колонок, детальные ошибки пользователю.
- KPI: нулевая «галлюцинация» — только подтверждённые поля, при отсутствии данных — явный пропуск.

**Модуль 3 — Мультимодальность (минимум)**
- Голосовой ввод запроса (локальный ASR) — опционально.
- Подготовка пайплайна для будущего OCR (без релиза в прод).

**Модуль 4 — RAG**
- Локальный индекс регламентов/шаблонов DOCX/XLSX/CSV.
- Агент использует контекст регламентов для формирования правильного разреза отчётов.
- KPI: снижение ручных подсказок пользователю, корректные поля в 90% кейсов.

**Модуль 5 — LangGraph (агентные workflow)**
- Разделение на **Agent‑Updater** и **Agent‑Analyst**; граф: Fetch→Normalize→Index / Validate→Analyze→Render→Export.
- Планировщик синхронизаций (кнопка «Обновить данные» + авто при старте).
- KPI: обновление + отчёт из нескольких источников (локальный Excel + Google Sheets).

**Модуль 6 — MCP интеграции**
- MCP‑инструменты: Google Sheets (чтение), почта (парсинг вложений CSV/XLSX), файловый вотчер, экспорт отчётов по почте/в Telegram.
- KPI: один клик «Еженедельный пакет отчётов» с рассылкой локальными средствами.

**Финал — Упаковка, безопасность и UX**
- Шифрование локального хранилища/индекса; `.env` секреты.
- Инсталлятор для Windows, простой GUI с шорткатами.
- KPI: «кнопка → готовый пакет отчётов ≤ 2 минуты», стабильность на данных 1С/Excel/Google Sheets.

---

## Дополнительно: Метрики успеха и контроль качества
- Время подготовки регулярного отчёта ≤ 2 минут.
- Доля корректных сопоставлений/агрегаций ≥ 99% (по контрольным сэмплам).
- 0 «тихих» ошибок: при дефиците данных — явное уведомление и списки пропусков.

## Ограничения и риски
- Качество локальной LLM (скорость/контекст) — предусмотреть бэкап‑режим без генеративки (чистый Pandas‑путь по шаблонам).
- Разнородность выгрузок 1С — нормализация и словари соответствий (поставщики/статьи/коды).
- Авторизации к внешним ресурсам — хранение токенов/куки локально, периодическая переавторизация.

